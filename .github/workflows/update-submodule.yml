name: Update Submodule

on:
  schedule:
    # 定时任务：每月的 1 日凌晨 1 点运行（UTC 时间）
    - cron: '0 1 1 * *'
  workflow_dispatch: # 手动触发工作流

jobs:
  update-submodule:
    runs-on: ubuntu-latest

    steps:
      # 检出主仓库
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          submodules: recursive # 同时检出子模块

      # 更新子模块到远程的最新提交
      - name: Update Submodules
        run: |
          git submodule update --remote --merge
          git status

      # 配置 Git 用户信息
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      # 提交子模块更新
      - name: Commit Changes
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            git add .
            git commit -m "Update submodule to latest version [CI]"
          else
            echo "No changes to commit."
          fi

      # 推送更新到主仓库
      - name: Push Changes
        run: |
          git push origin main